defaults: &DAD
    docker:
      - image: circleci/node:13.8.0
    working_directory: ~/react 
    
version: 2.1

commands:
  sy:
    parameters:
      to:
        type: string
        default: "crze"
    steps:
      - run : echo << parameters.to >>

      
jobs:
  build:
    <<: *DAD
    steps:
      - checkout
      - run: 
          name: "Install packages"
          command: npm i
      - save_cache:
          key: v2-node-modules
          paths:
            - ~/react/node_modules
      # - sy:
      #     to: "ZXEA"
      # - run: 
      #     name: "Install packages"
      #     command: |
      #       echo $NAME > output.txt
      # - persist_to_workspace:
      #     root: ~/react
      #     paths:
      #       - output.txt
  test:
    <<: *DAD
    steps:
      - checkout
      - restore_cache:
          keys:
            - v2-node-modules
      - run: echo "Test passed"
      # - run: npm run test

      # - attach_workspace:
      #     at: ~/react
      # - run: 
      #     name: "Print hello"
      #     command: |
      #       ls . 
      #       echo 'hello'
      #       cat ~/react/output.txt
      #       #cat /home/circleci/project/output.txt
  analyze:
    <<: *DAD
    steps:
      - checkout
      # - run: exit 1
      # - run: 
      #     name: "Print world"
      #     command: echo "world passed"
      - restore_cache:
          keys:
            - v2-node-modules
      - run: npm audit
      - run: 
          name: "Print world"
          command: echo "world failed"
          when: on_fail

workflows:
  default:
    jobs:
      - build
      - test:
          requires:
            - build
      - analyze:
          requires:
            - test
